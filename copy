<!DOCTYPE HTML>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script type="text/javascript" src="script.js" defer></script>
<link rel="stylesheet" href="style.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link href="//db.onlinewebfonts.com/c/84cb021d5f9af287ffff84b61beef6dc?family=clockicons" rel="stylesheet" type="text/css"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.13.0/moment.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment-duration-format/1.3.0/moment-duration-format.min.js"></script>
</head>
<body>
    <div class="zone">

        <div id="dropZ">
          <i class="fa fa-cloud-upload"></i>
          <div>Drag and drop your files here</div> <br>                   
          <span>OR</span><br>
          <div class="selectFile" id="droppingzone">       
            <label for="file">Select file</label>                   
            <input type="file" id="file" multiple="multiple" onchange="preview()">
          </div>
          <p>File size limit : 1 MB</p>
        </div>
      </div>
      <div id="presentationdiv">
        <table role="presentation" class="table table-striped">
            <tbody class="files" id="outputdiv">
               
        </tbody>
          </table>
          <button type="submit" onclick="move()" class="upload-btn" >Upload</button>
      </div>

      <script>

        const output = document.querySelector("outputdiv");
        const input = document.querySelector("#file");
        var imagesArray = [];
        function preview() {
            //$("#presentationdiv").show();
            // validateSize(image,index);
            const files = input.files
                for (let i = 0; i < files.length; i++) {
                    imagesArray.push(files[i])
                }
            //console.log(imagesArray);
            displayImages();
        }
        ///////////////////////////////////////////////////////
        var dropZone = document.getElementById('droppingzone');

// Optional.   Show the copy icon when dragging over.  Seems to only work for chrome.
dropZone.addEventListener('dragover', function(e) {
    e.stopPropagation();
    e.preventDefault();
    e.dataTransfer.dropEffect = 'copy';
});

// Get file data on drop
dropZone.addEventListener('drop', function(e) {
    e.stopPropagation();
    e.preventDefault();
     var dropfileslist=e.dataTransfer.files; // Array of all files
     imagesArray.push(dropfileslist[0]);
     console.log(imagesArray);
    displayImages();
});
///////////////////////////////////////////////////////////////////////////////
        const reader = new FileReader();
    function displayImages() {
      // console.log(imagesArray);
      $("#presentationdiv").show();
  let images = ""
  imagesArray.forEach((image, index) => {
  //console.log(image);
 validateSize(image,index);
    images += `<tr class="template-upload fade in">
                <td width=25% class="image">
                    <img  src="${URL.createObjectURL(image)}" class="img">
                </td>
                <td width="32%">
                    <p class="name">${imagesArray[index].name}</p>
                    <div id="danger" class="text-danger">File is too large</div>
                </td>
                <td width="22%">
                    <p class="size">${(imagesArray[index].size/1024/1024).toFixed(2)}MB</p>
                    <div class="progress" id="myProgress">
                        <div id="myBar"></div>
                </td>
                <td class="presbtns">
                        <input type="checkbox" name="complete" id="complete" checked style="display:none">
                        <button class="btn btn-warning cancel" onclick="deleteImage(${index})">
                            <i class="fa fa-trash-o"></i>
                        </button>
                    
                </td>
            </tr>`
            
        //     const size = 
        //      (imagesArray[index].size / 1024 / 1024).toFixed(2);
        
        //   if (size > 1) {
        //      // alert("File must be between the size of 1 MB");
        //       $("#danger"+index).css("display","block");
        //   } 
  })
  //output.innerHTML = images;
  $("#outputdiv").html(images);

}

function deleteImage(index) {
  imagesArray.splice(index, 1)
  displayImages()
}


function validateSize(image,index) {
   // console.log(image,index,"validate");
  const fileSize = image.size / 1024 / 1024; // in MiB
  console.log(fileSize.toFixed(2));
  if (fileSize.toFixed(2) < 1) {
  //  alert('File size Greater then 1MiB!');
    $("#danger").show();
    
  }

}
var i = 0;
function move() {
  if (i == 0) {
    i = 1;
    var elem = document.getElementById("myBar");
    var width = 1;
    var id = setInterval(frame, 10);
    function frame() {
      if (width >= 100) {
        clearInterval(id);
        i = 0;
        $('#complete').show();
      } else {
        width++;
        elem.style.width = width + "%";
      }
    }
  }
}
      </script>
</body>
</html>
